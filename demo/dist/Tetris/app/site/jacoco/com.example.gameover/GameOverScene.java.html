<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameOverScene.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tetris</a> &gt; <a href="index.source.html" class="el_package">com.example.gameover</a> &gt; <span class="el_source">GameOverScene.java</span></div><h1>GameOverScene.java</h1><pre class="source lang-java linenums">package com.example.gameover;

import java.util.ArrayList;
import java.util.Comparator;
import java.util.List;
import java.util.Objects;
import java.util.Optional;

import com.example.Router;

import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.ListView;
import javafx.scene.control.TextInputDialog;
import javafx.scene.layout.HBox;
import javafx.scene.layout.VBox;
import javafx.scene.text.Font;
import javafx.scene.text.FontWeight;
import javafx.scene.text.Text;
import javafx.stage.Stage;

<span class="nc" id="L25">public class GameOverScene {</span>

    private static final int MAX_SCORES = 10; // 상위 10개만 표시

<span class="nc" id="L29">    private static final List&lt;ScoreEntry&gt; LEADERBOARD = new ArrayList&lt;&gt;();</span>

    public static void show(Stage stage, int finalScore) {
        // top10 미만이거나 최하위보다 크면 등록
<span class="nc" id="L33">        boolean qualifies = qualifies(finalScore);</span>

<span class="nc" id="L35">        ScoreEntry currentPlayer = null;</span>
<span class="nc bnc" id="L36" title="All 2 branches missed.">        if (qualifies) {</span>
<span class="nc" id="L37">            String name = askName(stage, finalScore);</span>
<span class="nc bnc" id="L38" title="All 2 branches missed.">            if(name == null){</span>
<span class="nc" id="L39">                currentPlayer = null; // 취소 눌렀을 때</span>
            }else{
<span class="nc bnc" id="L41" title="All 2 branches missed.">                if(name.trim().isEmpty()) {</span>
<span class="nc" id="L42">                    name = &quot;Player&quot;; // 빈 이름 방지</span>
                }
<span class="nc" id="L44">            currentPlayer = addScore(name.trim(), finalScore); // 보드에 추가하고 참조 반환</span>
            }
        }

        //정렬 후 화면 생성
<span class="nc" id="L49">        Scene scene = create(stage, LEADERBOARD, currentPlayer, 400, 500);</span>
<span class="nc" id="L50">        stage.setScene(scene);</span>
<span class="nc" id="L51">        stage.show();</span>
<span class="nc" id="L52">    }</span>

    public static Scene create(Stage stage, List&lt;ScoreEntry&gt; scores, ScoreEntry currentPlayer, int width, int height) {
<span class="nc" id="L55">        VBox root = new VBox(20);</span>
<span class="nc" id="L56">        root.setAlignment(Pos.TOP_CENTER);</span>
<span class="nc" id="L57">        root.setPadding(new Insets(40, 20, 40, 20));</span>

<span class="nc" id="L59">        Text gameOverText = new Text(&quot;게임 종료&quot;);</span>
<span class="nc" id="L60">        gameOverText.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 36));</span>

<span class="nc" id="L62">        Label scoreBoardLabel = new Label(&quot;🏆 스코어 보드&quot;);</span>
<span class="nc" id="L63">        scoreBoardLabel.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 24));</span>

<span class="nc" id="L65">        ListView&lt;HBox&gt; scoreListView = new ListView&lt;&gt;();</span>
        // 화면 크기에 비례한 리스트 높이 계산
<span class="nc" id="L67">        int listHeight = Math.min((26 * MAX_SCORES) + 20, height - 200);</span>
<span class="nc" id="L68">        scoreListView.setPrefHeight(listHeight);</span>
<span class="nc" id="L69">        scoreListView.setMaxHeight(listHeight);</span>

<span class="nc" id="L71">        scores.sort(Comparator.comparingInt(ScoreEntry::getScore).reversed());</span>

<span class="nc bnc" id="L73" title="All 2 branches missed.">        for (int i = 0; i &lt; Math.min(scores.size(), MAX_SCORES); i++) {</span>
<span class="nc" id="L74">            ScoreEntry entry = scores.get(i);</span>
<span class="nc" id="L75">            String text = String.format(&quot;%2d. %s - %d점&quot;, i + 1, entry.getName(), entry.getScore());</span>

<span class="nc" id="L77">            Label label = new Label(text);</span>
<span class="nc" id="L78">            label.setFont(Font.font(&quot;Arial&quot;, 16));</span>

<span class="nc" id="L80">            HBox row = new HBox(label);</span>
<span class="nc" id="L81">            row.setPadding(new Insets(5));</span>

<span class="nc bnc" id="L83" title="All 2 branches missed.">            if (entry.equals(currentPlayer)) {</span>
<span class="nc" id="L84">                row.setStyle(&quot;-fx-background-color: #ffd700;&quot;);</span>
<span class="nc" id="L85">                label.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 16));</span>
            }

<span class="nc" id="L88">            scoreListView.getItems().add(row);</span>
        }
<span class="nc" id="L90">        HBox buttons = new HBox(12);</span>
<span class="nc" id="L91">        buttons.setAlignment(Pos.CENTER);</span>

        // 메인으로 돌아가는 버튼 추가
<span class="nc" id="L94">        Button mainMenuButton = new Button(&quot;메인으로&quot;);</span>
<span class="nc" id="L95">        mainMenuButton.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 18));</span>
<span class="nc" id="L96">        mainMenuButton.setPrefSize(120, 40);</span>
<span class="nc" id="L97">        mainMenuButton.setStyle(&quot;-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-background-radius: 5;&quot;);</span>
        
<span class="nc" id="L99">        mainMenuButton.setOnAction(e -&gt; {</span>
<span class="nc" id="L100">            Router router = new Router(stage);</span>
<span class="nc" id="L101">            router.showStartMenu();</span>
<span class="nc" id="L102">        });</span>

<span class="nc" id="L104">        Button quitButton = new Button(&quot;종료&quot;);</span>
<span class="nc" id="L105">        quitButton.setFont(Font.font(&quot;Arial&quot;, FontWeight.BOLD, 18));</span>
<span class="nc" id="L106">        quitButton.setPrefSize(120, 40);</span>
<span class="nc" id="L107">        quitButton.setStyle(&quot;-fx-background-color: #D32F2F; -fx-text-fill: white; -fx-background-radius: 5;&quot;);</span>
<span class="nc" id="L108">        quitButton.setOnAction(e -&gt; stage.close());</span>

<span class="nc" id="L110">        buttons.getChildren().addAll(mainMenuButton, quitButton);</span>

<span class="nc" id="L112">        root.getChildren().addAll(gameOverText, scoreBoardLabel, scoreListView, buttons);</span>
<span class="nc" id="L113">        return new Scene(root, width, height);</span>
    }
    
    // 기존 메소드 호환성 유지
    public static Scene create(Stage stage, List&lt;ScoreEntry&gt; scores, ScoreEntry currentPlayer) {
<span class="nc" id="L118">        return create(stage, scores, currentPlayer, 400, 500);</span>
    }

    // 이름 입력
    private static String askName(Stage stage, int score) {
<span class="nc" id="L123">        TextInputDialog dialog = new TextInputDialog();</span>
<span class="nc" id="L124">        dialog.setTitle(&quot;이름 입력&quot;);</span>
<span class="nc" id="L125">        dialog.setHeaderText(&quot;축하합니다! 새로운 기록을 세우셨습니다: &quot; + score + &quot;점&quot;);</span>
<span class="nc" id="L126">        dialog.setContentText(&quot;이름을 입력하세요:&quot;);</span>

<span class="nc" id="L128">        Optional&lt;String&gt; result = dialog.showAndWait();</span>
<span class="nc" id="L129">        return result.orElse(null);</span>
    }

    //등록 자격
    private static boolean qualifies(int score) {
<span class="nc bnc" id="L134" title="All 2 branches missed.">        if (LEADERBOARD.size() &lt; MAX_SCORES) {</span>
<span class="nc" id="L135">            return true;</span>
        }
<span class="nc" id="L137">        int min = LEADERBOARD.stream().mapToInt(ScoreEntry::getScore).min().orElse(Integer.MIN_VALUE);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">        return score &gt; min;</span>
    }

    // 등록
    private static ScoreEntry addScore(String name, int score) {
<span class="nc" id="L143">        ScoreEntry entry = new ScoreEntry(name, score);</span>
<span class="nc" id="L144">        LEADERBOARD.add(entry);</span>
<span class="nc" id="L145">        LEADERBOARD.sort(Comparator.comparingInt(ScoreEntry::getScore).reversed());</span>
        // 상위 N개만 유지
<span class="nc bnc" id="L147" title="All 2 branches missed.">        if (LEADERBOARD.size() &gt; MAX_SCORES) {</span>
<span class="nc" id="L148">            LEADERBOARD.remove(LEADERBOARD.size() - 1);</span>
        }
<span class="nc" id="L150">        return entry;</span>
    }

    // ScoreEntry 내부 클래스
    public static class ScoreEntry {
        private String name;
        private int score;

<span class="nc" id="L158">        public ScoreEntry(String name, int score) {</span>
<span class="nc" id="L159">            this.name = name;</span>
<span class="nc" id="L160">            this.score = score;</span>
<span class="nc" id="L161">        }</span>

        public String getName() {
<span class="nc" id="L164">            return name;</span>
        }

        public int getScore() {
<span class="nc" id="L168">            return score;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L173" title="All 2 branches missed.">            if (this == obj) return true;</span>
<span class="nc bnc" id="L174" title="All 4 branches missed.">            if (obj == null || getClass() != obj.getClass()) return false;</span>
<span class="nc" id="L175">            ScoreEntry that = (ScoreEntry) obj;</span>
<span class="nc bnc" id="L176" title="All 4 branches missed.">            return score == that.score &amp;&amp; Objects.equals(name, that.name);</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L181">            return Objects.hash(name, score);</span>
        }
    }
}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>