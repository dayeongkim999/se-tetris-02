<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameSettings.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tetris</a> &gt; <a href="index.source.html" class="el_package">com.example.settings</a> &gt; <span class="el_source">GameSettings.java</span></div><h1>GameSettings.java</h1><pre class="source lang-java linenums">package com.example.settings;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.prefs.Preferences;

import com.example.theme.ColorScheme;

import javafx.scene.input.KeyCode;
import javafx.scene.paint.Color;

// 화면 크기 열거형 추가
<span class="fc" id="L15">enum WindowSize {</span>
<span class="fc" id="L16">    SMALL(&quot;작은 화면&quot;, 400, 520),</span>
<span class="fc" id="L17">    MEDIUM(&quot;중간 화면&quot;, 480, 640),</span>
<span class="fc" id="L18">    LARGE(&quot;큰 화면&quot;, 560, 720),</span>
<span class="fc" id="L19">    EXTRA_LARGE(&quot;매우 큰 화면&quot;, 640, 800);</span>
    
    private final String displayName;
    private final int width;
    private final int height;
    
<span class="fc" id="L25">    WindowSize(String displayName, int width, int height) {</span>
<span class="fc" id="L26">        this.displayName = displayName;</span>
<span class="fc" id="L27">        this.width = width;</span>
<span class="fc" id="L28">        this.height = height;</span>
<span class="fc" id="L29">    }</span>
    
<span class="fc" id="L31">    public String getDisplayName() { return displayName; }</span>
<span class="fc" id="L32">    public int getWidth() { return width; }</span>
<span class="fc" id="L33">    public int getHeight() { return height; }</span>
}

public class GameSettings {
    private static GameSettings instance;
    private Preferences prefs;
    private ColorScheme currentColorScheme;
    private Map&lt;String, Color&gt; customColors;
    private WindowSize currentWindowSize;
    private Map&lt;String, KeyCode&gt; keyBindings;
    private List&lt;Runnable&gt; windowSizeChangeListeners;
    
<span class="fc" id="L45">    private GameSettings() {</span>
<span class="fc" id="L46">        prefs = Preferences.userNodeForPackage(GameSettings.class);</span>
<span class="fc" id="L47">        windowSizeChangeListeners = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L48">        loadSettings();</span>
<span class="fc" id="L49">    }</span>
    
    // 싱글톤 인스턴스 반환
    public static GameSettings getInstance() {
<span class="fc bfc" id="L53" title="All 2 branches covered.">        if (instance == null) {</span>
<span class="fc" id="L54">            instance = new GameSettings();</span>
        }
<span class="fc" id="L56">        return instance;</span>
    }
    
    // 설정 불러오기
    private void loadSettings() {
<span class="fc" id="L61">        String schemeName = prefs.get(&quot;colorScheme&quot;, ColorScheme.NORMAL.name());</span>
        try {
<span class="fc" id="L63">            currentColorScheme = ColorScheme.valueOf(schemeName);</span>
<span class="nc" id="L64">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L65">            currentColorScheme = ColorScheme.NORMAL;</span>
<span class="fc" id="L66">        }</span>
        
        // 창 크기 설정 불러오기
<span class="fc" id="L69">        String windowSizeName = prefs.get(&quot;windowSize&quot;, WindowSize.MEDIUM.name());</span>
        try {
<span class="fc" id="L71">            currentWindowSize = WindowSize.valueOf(windowSizeName);</span>
<span class="nc" id="L72">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L73">            currentWindowSize = WindowSize.MEDIUM;</span>
<span class="fc" id="L74">        }</span>
        
<span class="fc" id="L76">        loadCustomColors();</span>
<span class="fc" id="L77">        loadKeyBindings();</span>
<span class="fc" id="L78">    }</span>
    
    // 커스텀 색상 불러오기
    private void loadCustomColors() {
<span class="fc" id="L82">        customColors = new HashMap&lt;&gt;();</span>
<span class="fc" id="L83">        String[] blockTypes = {&quot;block-i&quot;, &quot;block-o&quot;, &quot;block-j&quot;, &quot;block-l&quot;, &quot;block-s&quot;, &quot;block-t&quot;, &quot;block-z&quot;};</span>
        
<span class="fc bfc" id="L85" title="All 2 branches covered.">        for (String blockType : blockTypes) {</span>
<span class="fc" id="L86">            String colorHex = prefs.get(&quot;custom_&quot; + blockType, &quot;#ffffff&quot;);</span>
            try {
<span class="fc" id="L88">                customColors.put(blockType, Color.web(colorHex));</span>
<span class="nc" id="L89">            } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L90">                customColors.put(blockType, Color.WHITE);</span>
<span class="fc" id="L91">            }</span>
        }
<span class="fc" id="L93">    }</span>
    
    // 키 바인딩 불러오기
    private void loadKeyBindings() {
<span class="fc" id="L97">        keyBindings = new HashMap&lt;&gt;();</span>
        // 기본 키 설정
<span class="fc" id="L99">        keyBindings.put(&quot;MOVE_LEFT&quot;, KeyCode.valueOf(prefs.get(&quot;key_move_left&quot;, &quot;LEFT&quot;)));</span>
<span class="fc" id="L100">        keyBindings.put(&quot;MOVE_RIGHT&quot;, KeyCode.valueOf(prefs.get(&quot;key_move_right&quot;, &quot;RIGHT&quot;)));</span>
<span class="fc" id="L101">        keyBindings.put(&quot;MOVE_DOWN&quot;, KeyCode.valueOf(prefs.get(&quot;key_move_down&quot;, &quot;DOWN&quot;)));</span>
<span class="fc" id="L102">        keyBindings.put(&quot;ROTATE&quot;, KeyCode.valueOf(prefs.get(&quot;key_rotate&quot;, &quot;UP&quot;)));</span>
<span class="fc" id="L103">        keyBindings.put(&quot;PAUSE&quot;, KeyCode.valueOf(prefs.get(&quot;key_pause&quot;, &quot;ESCAPE&quot;)));</span>
<span class="fc" id="L104">        keyBindings.put(&quot;HARD_DROP&quot;, KeyCode.valueOf(prefs.get(&quot;key_hard_drop&quot;, &quot;DOWN&quot;)));</span>
<span class="fc" id="L105">    }</span>
    
    // 설정 저장
    public void saveSettings() {
<span class="fc" id="L109">        prefs.put(&quot;colorScheme&quot;, currentColorScheme.name());</span>
<span class="fc" id="L110">        prefs.put(&quot;windowSize&quot;, currentWindowSize.name());</span>
        
<span class="fc bfc" id="L112" title="All 2 branches covered.">        if (currentColorScheme == ColorScheme.CUSTOM) {</span>
<span class="fc bfc" id="L113" title="All 2 branches covered.">            for (Map.Entry&lt;String, Color&gt; entry : customColors.entrySet()) {</span>
<span class="fc" id="L114">                String hex = String.format(&quot;#%02x%02x%02x&quot;,</span>
<span class="fc" id="L115">                    (int)(entry.getValue().getRed() * 255),</span>
<span class="fc" id="L116">                    (int)(entry.getValue().getGreen() * 255),</span>
<span class="fc" id="L117">                    (int)(entry.getValue().getBlue() * 255));</span>
<span class="fc" id="L118">                prefs.put(&quot;custom_&quot; + entry.getKey(), hex);</span>
<span class="fc" id="L119">            }</span>
        }
        
        // 키 바인딩 저장
<span class="fc" id="L123">        prefs.put(&quot;key_move_left&quot;, keyBindings.get(&quot;MOVE_LEFT&quot;).name());</span>
<span class="fc" id="L124">        prefs.put(&quot;key_move_right&quot;, keyBindings.get(&quot;MOVE_RIGHT&quot;).name());</span>
<span class="fc" id="L125">        prefs.put(&quot;key_move_down&quot;, keyBindings.get(&quot;MOVE_DOWN&quot;).name());</span>
<span class="fc" id="L126">        prefs.put(&quot;key_rotate&quot;, keyBindings.get(&quot;ROTATE&quot;).name());</span>
<span class="fc" id="L127">        prefs.put(&quot;key_pause&quot;, keyBindings.get(&quot;PAUSE&quot;).name());</span>
<span class="fc" id="L128">        prefs.put(&quot;key_hard_drop&quot;, keyBindings.get(&quot;HARD_DROP&quot;).name());</span>
<span class="fc" id="L129">    }</span>
    
    // 현재 색상 테마 및 커스텀 색상 접근자
    public ColorScheme getCurrentColorScheme() {
<span class="fc" id="L133">        return currentColorScheme;</span>
    }
    
    // 현재 색상 테마 설정
    public void setCurrentColorScheme(ColorScheme scheme) {
<span class="fc" id="L138">        this.currentColorScheme = scheme;</span>
<span class="fc" id="L139">        saveSettings();</span>
<span class="fc" id="L140">    }</span>
    
    // 현재 색상 맵 반환
    public Map&lt;String, Color&gt; getCurrentColors() {
<span class="fc bfc" id="L144" title="All 2 branches covered.">        if (currentColorScheme == ColorScheme.CUSTOM) {</span>
<span class="fc" id="L145">            return new HashMap&lt;&gt;(customColors);</span>
        }
<span class="fc" id="L147">        return currentColorScheme.getColorMap();</span>
    }
    
    // 커스텀 색상 설정
    public void setCustomColor(String blockType, Color color) {
<span class="fc" id="L152">        customColors.put(blockType, color);</span>
<span class="pc bpc" id="L153" title="1 of 2 branches missed.">        if (currentColorScheme == ColorScheme.CUSTOM) {</span>
<span class="fc" id="L154">            saveSettings();</span>
        }
<span class="fc" id="L156">    }</span>
    
    // 특정 블록 타입의 커스텀 색상 반환
    public Color getCustomColor(String blockType) {
<span class="fc" id="L160">        return customColors.getOrDefault(blockType, Color.WHITE);</span>
    }
    
    // 창 크기 관련 메소드 추가
    public WindowSize getCurrentWindowSize() {
<span class="fc" id="L165">        return currentWindowSize;</span>
    }
    
    public void setCurrentWindowSize(WindowSize windowSize) {
<span class="fc" id="L169">        this.currentWindowSize = windowSize;</span>
<span class="fc" id="L170">        saveSettings();</span>
        // 모든 리스너들에게 창 크기 변경 알림
<span class="fc" id="L172">        notifyWindowSizeChangeListeners();</span>
<span class="fc" id="L173">    }</span>
    
    public int getWindowWidth() {
<span class="fc" id="L176">        return currentWindowSize.getWidth();</span>
    }
    
    public int getWindowHeight() {
<span class="fc" id="L180">        return currentWindowSize.getHeight();</span>
    }
    
    // 키 바인딩 관련 메서드
    public KeyCode getKeyBinding(String action) {
<span class="fc" id="L185">        return keyBindings.get(action);</span>
    }
    
    public void setKeyBinding(String action, KeyCode keyCode) {
<span class="fc" id="L189">        keyBindings.put(action, keyCode);</span>
<span class="fc" id="L190">        saveSettings();</span>
<span class="fc" id="L191">    }</span>
    
    public Map&lt;String, KeyCode&gt; getAllKeyBindings() {
<span class="fc" id="L194">        return new HashMap&lt;&gt;(keyBindings);</span>
    }
    
    public void resetKeyBindingsToDefault() {
<span class="fc" id="L198">        keyBindings.put(&quot;MOVE_LEFT&quot;, KeyCode.LEFT);</span>
<span class="fc" id="L199">        keyBindings.put(&quot;MOVE_RIGHT&quot;, KeyCode.RIGHT);</span>
<span class="fc" id="L200">        keyBindings.put(&quot;MOVE_DOWN&quot;, KeyCode.DOWN);</span>
<span class="fc" id="L201">        keyBindings.put(&quot;ROTATE&quot;, KeyCode.UP);</span>
<span class="fc" id="L202">        keyBindings.put(&quot;HARD_DROP&quot;, KeyCode.SPACE);</span>
<span class="fc" id="L203">        saveSettings();</span>
<span class="fc" id="L204">    }</span>
    
    // 창 크기 변경 리스너 관리
    public void addWindowSizeChangeListener(Runnable listener) {
<span class="pc bpc" id="L208" title="1 of 2 branches missed.">        if (!windowSizeChangeListeners.contains(listener)) {</span>
<span class="fc" id="L209">            windowSizeChangeListeners.add(listener);</span>
        }
<span class="fc" id="L211">    }</span>
    
    public void removeWindowSizeChangeListener(Runnable listener) {
<span class="fc" id="L214">        windowSizeChangeListeners.remove(listener);</span>
<span class="fc" id="L215">    }</span>
    
    private void notifyWindowSizeChangeListeners() {
<span class="fc bfc" id="L218" title="All 2 branches covered.">        for (Runnable listener : windowSizeChangeListeners) {</span>
            try {
<span class="fc" id="L220">                listener.run();</span>
<span class="nc" id="L221">            } catch (Exception e) {</span>
<span class="nc" id="L222">                System.err.println(&quot;Error in window size change listener: &quot; + e.getMessage());</span>
<span class="fc" id="L223">            }</span>
<span class="fc" id="L224">        }</span>
<span class="fc" id="L225">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>